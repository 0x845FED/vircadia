<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="../../html/js/jquery-2.1.4.min.js"></script>
<link rel="stylesheet" type="text/css" href="../../html/css/edit-style.css">

<style>
    iframe {
        height:100%;
        width:100%;
        position: absolute;
    }
    #tabs {
        background-color: black;
    }
    .tabButton {
        background-color: #000;
        color: white;
        font-size: 100%;
        padding: 12px;
        margin: 0px;
        text-align: center;
        vertical-align: middle;
        display: inline-block;
        user-select: none;
    }
    .tabIcon {
        width: 24px;
        height: 24px;
        padding-right: 12px;
    }
    .selected {
        background-color: #404040
    }
</style>
</head>
<body style="margin:0px;padding:0px;overflow:hidden">
    <div id="tabs">
        <span class="tabButton" onclick="selectTab(0)"><img class="tabIcon" src="../content/tabicons/colorpaletteBtn.png"/>Palette</span>
        <span class="tabButton" onclick="selectTab(1)"><img class="tabIcon" src="../content/tabicons/brushesBtn.png"/>Brushes</span>
        <span class="tabButton" onclick="selectTab(2)"><img class="tabIcon" src="../content/tabicons/eraser.png"/>Undo</span>
        <span class="tabButton" onclick="selectTab(3)"><img class="tabIcon" src="../content/tabicons/pointingfinger128px.png"/>Hand</span>
    </div>
    <div id="settingsLoading" style="display: none; background-color: #F44336; color: white; padding: 8px">Loading previous settings</div>
    <div id="content">
        <iframe frameborder="0" lastState="window.location.search" onload="frameLoaded(this)" src="colorsTab.html"     id="colorTab" seamless></iframe>
        <iframe frameborder="0" lastState="window.location.search" onload="frameLoaded(this)" src="brushesTab.html"    id="brushesTab" seamless style="display: none"></iframe>
        <iframe frameborder="0" lastState="window.location.search" onload="frameLoaded(this)" src="eraserTab.html"     id="eraserTab" seamless style="display: none"></iframe>
        <iframe frameborder="0" lastState="window.location.search" onload="frameLoaded(this)" src="chooseHandTab.html" id="chooseHandTab" seamless style="display: none"></iframe>
    </div>
</body>
</html>

<script type="text/javascript">
    var currentTab = 0;
    var iframesLoaded = 0;
    function selectTab(tabIndex) {
        var tabs = document.getElementById("tabs").children;
        var contentPanels = document.getElementById("content").children;
        tabs[currentTab].classList.remove("selected");
        contentPanels[currentTab].style.display = "none";
        contentPanels[tabIndex].style.display = "block";
        tabs[tabIndex].classList.add("selected");
        currentTab = tabIndex;
        var changeTabEvent = {
            "type"     : "changeTab",
            "currentTab": tabIndex
        };
        EventBridge.emitWebEvent(JSON.stringify(changeTabEvent));
    }

    function frameLoaded(iframe) {
        iframesLoaded++;
        if (iframesLoaded == $("#content").children().length) {
            var appReadyEvent = {
                "type" : "appReady",
            };
            EventBridge.emitWebEvent(JSON.stringify(appReadyEvent));
        }
    }

    EventBridge.scriptEventReceived.connect(function (message) {
        var event = JSON.parse(message); 
        if (event.type == "undoDisable") {
            document.getElementById("eraserTab").contentWindow.postMessage(message, "*");
        }       
    });
    //Accept events function() from iframes
    //https://stackoverflow.com/questions/8822907/html5-cross-browser-iframe-postmessage-child-to-parent
    var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
    var eventer = window[eventMethod];
    var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

    //restore last opened tab
    selectTab(JSON.parse(decodeURIComponent(window.location.search).substring(1)).currentTab);    
   
    // Listen to message from child window
    eventer(messageEvent,function(e) {
        EventBridge.emitWebEvent(e.data);
    }, false);
</script>

