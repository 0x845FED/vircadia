<html>
  <head>
    <title>Share</title>
    <link rel="stylesheet" type="text/css" href="css/edit-style.css">
    <style type="text/css">

        .snapshot-container {
            width: 100%;
            padding-top: 3px;
        }

        .snapshot-column-left {
            width: 320px;
            position: absolute;
            padding-top: 8px;
        }

        .snapshot-column-right {
            margin-left: 342px;
        }
      
        .snapshot-column-right > div > img {
            width: 100%;
        }

        @media (max-width: 768px) {
            .snapshot-column-left {
                position: initial;
                width: 100%;
            }
            .snapshot-column-right {
                margin-left: 0;
                width: 100%;
            }
            .snapshot-column-right > div > img {
                margin-top: 18px !important;
            }
        }

        .snapshot-column-right > div {
            position: relative;
            padding: 2px;
        }

        .snapshot-column-right > div > img {
            border: 2px solid #575757;
            margin: -2px;
        }

        hr {
            padding-left: 0;
            padding-right: 0;
            margin: 21px 0;
        }

        .snapsection {
            text-align: center;
        }

        .title {
            text-transform: uppercase;
            font-size: 12px;
        }

        .prompt {
            font-family: Raleway-SemiBold;
            font-size: 14px;
        }

        div.button {
            padding-top: 21px;
        }

        .compound-button {
            position: relative;
            height: auto;
        }

        .compound-button input {
            padding-left: 40px;
        }

        .compound-button .glyph {
            display: inline-block;
            position: absolute;
            left: 12px;
            top: 16px;
            width: 23px;
            height: 23px;
            background-image: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgaGVpZ2h0PSI0MCIKICAgd2lkdGg9IjQwIgogICBpZD0ic3ZnMiIKICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgdmlld0JveD0iMCAwIDQwIDQwIgogICB5PSIwcHgiCiAgIHg9IjBweCIKICAgdmVyc2lvbj0iMS4xIj48bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGEzNCI+PHJkZjpSREY+PGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPjxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PjxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz48ZGM6dGl0bGU+PC9kYzp0aXRsZT48L2NjOldvcms+PC9yZGY6UkRGPjwvbWV0YWRhdGE+PGRlZnMKICAgICBpZD0iZGVmczMyIiAvPjxzdHlsZQogICAgIGlkPSJzdHlsZTQiCiAgICAgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiM0MTQwNDI7fQoJLnN0MXtmaWxsOiNDQ0NDQ0M7fQoJLnN0MntmaWxsOiMxMzk4QkI7fQoJLnN0M3tmaWxsOiMzMUQ4RkY7fQo8L3N0eWxlPjxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTEwKSIKICAgICBpZD0iTGF5ZXJfMSI+PGNpcmNsZQogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MSIKICAgICAgIGlkPSJjaXJjbGUxMyIKICAgICAgIHI9IjQuNDQwMDAwMSIKICAgICAgIGN5PSIxMjYuMTciCiAgICAgICBjeD0iMjAuNTQwMDAxIgogICAgICAgY2xhc3M9InN0MSIgLz48cGF0aAogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MSIKICAgICAgIGlkPSJwYXRoMTUiCiAgICAgICBkPSJtIDI4Ljg3LDEzOS4yNiBjIDAuMDEsLTAuMDEgMC4wMiwtMC4wMiAwLjAzLC0wLjAzIGwgMCwtMS44NiBjIDAsLTIuNjggLTIuMzMsLTQuNzcgLTUsLTQuNzcgbCAtNi40MiwwIGMgLTIuNjgsMCAtNC44NSwyLjA5IC00Ljg1LDQuNzcgbCAwLDEuODggMTYuMjQsMCB6IgogICAgICAgY2xhc3M9InN0MSIgLz48cGF0aAogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLW9wYWNpdHk6MSIKICAgICAgIGlkPSJwYXRoMTciCiAgICAgICBkPSJtIDM4LjE3LDEyMy40MiBjIDAsLTMuOTcgLTMuMjIsLTcuMTkgLTcuMTksLTcuMTkgbCAtMjAuMzEsMCBjIC0zLjk3LDAgLTcuMTksMy4yMiAtNy4xOSw3LjE5IGwgMCwxNC4xOCBjIDAsMy45NyAzLjIyLDcuMTkgNy4xOSw3LjE5IGwgMjAuMzEsMCBjIDMuOTcsMCA3LjE5LC0zLjIyIDcuMTksLTcuMTkgbCAwLC0xNC4xOCB6IG0gLTEuNzgsMTQuMjcgYyAwLDMuMDMgLTIuNDYsNS40OSAtNS40OSw1LjQ5IGwgLTIwLjMyLDAgYyAtMy4wMywwIC01LjQ5LC0yLjQ2IC01LjQ5LC01LjQ5IGwgMCwtMTQuMTkgYyAwLC0zLjAzIDIuNDYsLTUuNDkgNS40OSwtNS40OSBsIDIwLjMzLDAgYyAzLjAzLDAgNS40OSwyLjQ2IDUuNDksNS40OSBsIDAsMTQuMTkgeiIKICAgICAgIGNsYXNzPSJzdDEiIC8+PC9nPjxnCiAgICAgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCwtMTEwKSIKICAgICBpZD0iTGF5ZXJfMiIgLz48L3N2Zz4=);
            background-repeat: no-repeat;
            background-size: 23px 23px;
        }

        .setting {
            display: inline-table;
            height: 28px;
        }

        .setting label {
            display: table-cell;
            vertical-align: middle;
            font-family: Raleway-SemiBold;
            font-size: 14px;
        }

        .setting + .setting {
            margin-left: 18px;
        }

        input[type=button].naked {
            font-size: 40px;
            line-height: 40px;
            width: 30px;
            padding: 0;
            margin: 0 0 -6px 0;
            position: relative;
            top: -6px;
            left: -8px;
            background: none;
        }

        input[type=button].naked:hover {
            color: #00b4ef;
            background: none;
        }
    </style>
    <script type="text/javascript" src="qrc:///qtwebchannel/qwebchannel.js"></script>
    <script type="text/javascript" src="js/eventBridgeLoader.js"></script>
    <script>
    var paths = [], idCounter = 0, useCheckboxes;
    function addImage(data) {
        var div = document.createElement("DIV"),
            input = document.createElement("INPUT"),
            label = document.createElement("LABEL"),
            img = document.createElement("IMG"),
            id = "p" + idCounter++;
        function toggle() { data.share = input.checked; }
        img.src = data.localPath;
        div.appendChild(img);
        data.share = true;
        if (useCheckboxes) { // I'd rather use css, but the included stylesheet is quite particular.
            // Our stylesheet(?) requires input.id to match label.for. Otherwise input doesn't display the check state.
            label.setAttribute('for', id); // cannot do label.for =
            input.id = id;
            input.type = "checkbox";
            input.checked = true;
            input.addEventListener('change', toggle);
            div.class = "property checkbox";
            div.appendChild(input);
            div.appendChild(label);
        }
        document.getElementById("snapshot-images").appendChild(div);
        paths.push(data);

    }
    function handleShareButtons(shareMsg) {
        var openFeed = document.getElementById('openFeed');
        openFeed.checked = shareMsg.openFeedAfterShare;
        openFeed.onchange = function () { EventBridge.emitWebEvent(openFeed.checked ? 'setOpenFeedTrue' : 'setOpenFeedFalse'); };
        if (!shareMsg.canShare) {
            // this means you may or may not be logged in, but can't share
            // because you are not in a public place.
            document.getElementById("sharing").innerHTML = "<p class='prompt'>Snapshots can be shared when they're taken in shareable places.";
        }
    }
    window.onload = function () {
        // Something like the following will allow testing in a browser.
        //addImage({localPath: 'c:/Users/howar/OneDrive/Pictures/hifi-snap-by--on-2016-07-27_12-58-43.jpg'});
        //addImage({localPath: 'http://lorempixel.com/1512/1680'});
        openEventBridge(function () {
            // Set up a handler for receiving the data, and tell the .js we are ready to receive it.
            EventBridge.scriptEventReceived.connect(function (message) {
                // last element of list contains a bool for whether or not we can share stuff
                var shareMsg = message.pop();
                handleShareButtons(shareMsg);
                
                // rest are image paths which we add
                useCheckboxes = message.length > 1;
                message.forEach(addImage);
            });
            EventBridge.emitWebEvent('ready');
         });

    };
    // beware of bug: Cannot send objects at top level. (Nested in arrays is fine.)
    shareSelected = function () {
        EventBridge.emitWebEvent(paths);
    };
    doNotShare = function () {
        EventBridge.emitWebEvent([]);
    };
    snapshotSettings = function () {
        EventBridge.emitWebEvent("openSettings");
    };
    </script>

  </head>

  <body>
    <div class="snapshot-container">
      <div class="snapshot-column-left">
        <div class="snapsection">
          <label class="title">Snapshot successfully saved!</label>
        </div>
        <hr />
        <div class="snapsection">
          <div id="sharing">
            <div class="prompt">Would you like to share your pic in the Snapshots feed?</div>
            <div class="button">
              <span class="compound-button">
                <input type="button" class="blue" id="share" value="Share in Feed" onclick="shareSelected()"/>
                <span class="glyph"></span>
              </span>
            </div>
          </div>
          <div class="button">
            <input type="button" class="black" id="close" value="Don't Share" onclick="doNotShare()"/>
          </div>
        </div>
        <hr />
        <div class="snapsection">
          <span class="setting">
            <input type="button" class="glyph naked" id="snapshotSettings" value="@" onclick="snapshotSettings()" />
            <label for="snapshotSettings">Snapshot settings</label>
          </span>
          <span class="setting checkbox">
            <input id="openFeed" type="checkbox" checked/>
            <label for="openFeed">Open feed after</label>
          </span>
        </div>
      </div>
      <div id="snapshot-images" class="snapshot-column-right"/>
      </div>
    </div>
  </body>
</html>
